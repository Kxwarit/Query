SELECT p.hn, concat(p.pname, p.fname, ' ', p.lname) as patient_name, STRING_AGG(c.name, ', ') as clinic  
FROM clinicmember cm
LEFT OUTER JOIN patient p ON p.hn = cm.hn
LEFT OUTER JOIN clinic c ON c.clinic = CASE WHEN cm.clinic = '001' THEN '096' ELSE cm.clinic END
WHERE cm.hn IN (
    '0046662', '5708759', '5506026', '4942070', '0067008', '6306833', '0048062', '5906450', '4954016', '6405350',
    '5802524', '5702869', '0046839', '0009182', '0023070', '6303929', '0031215', '6404991', '6508024', '6005420',
    '6304055', '0028386', '0046777', '6108508', '0067095', '6707326', '0088184', '5602210', '5502977', '0116638',
    '5203519', '5507277', '5201558', '6006821', '5803908', '0006994', '0046659', '0045934', '5800165', '6306883',
    '4953540', '4947300', '0073749', '0046582', '4940858', '6402976', '6606655', '5803907', '5507886', '6306694',
    '5703613', '5604697', '5305088', '5506908', '0099281', '6706274', '5307023', '6105698', '0098368', '0046677',
    '5505990', '0046365', '5303866', '0046641', '0047441', '5904122', '0025127', '0047375', '6303783', '0046858',
    '5306402', '5904239', '5708611', '6307803', '5506725', '0119736', '0112924', '6204553', '0004430', '0046739',
    '6204489', '0049992', '0105094', '5402069', '6307658', '0046661', '0082063', '6105692', '0045892', '5208655',
    '0112362', '5702807', '0088392', '0098901', '0046730', '0117236', '0013612', '0115985', '5502456', '5803121',
    '0118321', '0067175', '0098475', '6409675', '6303782', '5708673', '0046734', '5803313', '0054161', '0069726',
    '0028519', '6700345', '0058065', '4946516', '0001239', '6507632', '0032155', '0001786', '0046736', '0046725',
    '5704320', '6500583', '0023380', '5602946', '5405092', '6005583', '4953887', '0046362', '0120214', '6006762',
    '6707556', '5605665', '5907671', '6202440', '5100448', '4955019', '0046366', '0046452', '5500467', '5907122',
    '0016996', '0046369', '4948794', '0058029', '0046735', '6708039', '6508204', '6207362', '4953444', '6709748',
    '5806299', '6202912', '5507278', '4940720', '6101539', '6408268', '5402042', '6306366', '0046451', '5101746',
    '0046840', '6303395', '5801609', '6404994', '5702873', '0036580', '6103357', '5806298', '6202439', '5708128',
    '5400992', '5700678', '0046643', '5300498', '0046333', '6508645', '0016041', '0090276', '0046492', '6305510',
    '5906985', '0092298', '6303786', '4943377', '0057377', '6204586', '0096777', '0089242', '0046634', '0085096',
    '5606394', '6707759', '0083353', '6303766', '0030960', '5708610', '0046648', '4948225', '0040244', '0118385',
    '6203053', '5603483', '6307106', '5701689', '0009341', '0022942', '0034874', '0045444', '0046655', '0046660',
    '0046729', '0075033', '0082670', '5105733', '5106645', '5201578', '5207357', '6005228', '6102489', '6109574',
    '6303785', '6307800', '6407221', '5703617', '0056069', '6111063', '0056674', '0047367', '0046453', '6707709',
    '6503569', '0007171', '0097440', '0060394', '5502441', '6706832', '6005096', '0047048', '6601248', '6709967',
    '6405566', '6708644', '0013893', '0032973', '0060055', '0063758', '0010335', '0113492', '0043405', '0053534',
    '6702343', '0000027', '0055529', '0047299', '6100930', '6713903', '6713227', '6503594', '0101792', '0031286',
    '0048438', '6401835', '0095233', '0092920', '0061640', '0017180', '0035639', '0090788', '0074375', '0044571',
    '0028009', '0030764', '0027220', '5608017', '0053888', '4940757', '6701699', '0019837', '0038616', '0054528',
    '5700500', '5607283', '5306401', '6604743', '6409462', '0005139', '6610244', '0084233', '0006783', '0084426',
    '5500464', '6209803', '0018256', '6712774', '6708679', '0091431', '0011533', '6608812', '0067415', '5200400',
    '6501660', '6703228', '6607257', '0065285', '6604235'
)
GROUP BY p.hn, p.pname, p.fname, p.lname  
ORDER BY p.hn
